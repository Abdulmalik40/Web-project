<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prayer Times ‚Ä¢ Islamic Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;800;900&family=Tajawal:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles/main.css" />
    <style>
      body {
        overflow-x: hidden;
      }
      .prayer-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px 80px;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* Hero banner using mosque photo */
      .hero-banner {
        width: 100vw;
        min-height: 42vh;
        margin-top: 90px; /* clears sticky site header */
        margin-left: calc(50% - 50vw);
        margin-right: calc(50% - 50vw);
        border-radius: 0;
        background: url("../assets/images/header_photo/mosuqe.jpg") center/cover
          no-repeat;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        z-index: 0;
      }

      .hero-banner::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.5),
          rgba(0, 0, 0, 0.6)
        );
        pointer-events: none;
        z-index: 0;
      }

      .hero-content {
        position: relative;
        z-index: 1;
        height: 100%;
        min-height: 42vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 40px 20px;
      }

      .prayer-header {
        /* used inside hero */
        text-align: center;
        margin: 0;
        position: relative;
      }

      .prayer-title {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 900;
        font-size: 3.25rem;
        margin: 0 0 20px;
        color: #ffffff;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
      }

      @keyframes gradientShift {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .prayer-subtitle {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.85);
        margin: 10px 0 0;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.6;
        font-weight: 400;
      }

      /* Remove emoji above subtitle */
      .prayer-subtitle::before {
        content: none;
      }

      /* Blur, translucent site header */
      .header {
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        background: rgba(0, 0, 0, 0.35);
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .prayer-widget-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        margin: 24px auto 0; /* place just below hero */
        max-width: 520px;
        width: 100%;
        align-items: start;
        position: relative;
        z-index: 2; /* ensure above hero overlay */
      }

      .location-card {
        background: #0f0f10;
        border-radius: 20px;
        padding: 28px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        border: 1px solid #1f1f20;
        position: relative;
        overflow: hidden;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        text-align: center;
      }

      .location-card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: rotate 20s linear infinite;
        z-index: 0;
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .location-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 36px rgba(0, 0, 0, 0.2);
      }

      .prayer-times-card {
        background: #0f0f10;
        border-radius: 20px;
        padding: 28px;
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
        border: 1px solid #1f1f20;
        position: relative;
        overflow: hidden;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .prayer-times-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.03)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.03)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.06;
        z-index: 0;
      }

      .prayer-times-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 26px 60px rgba(0, 0, 0, 0.45);
      }

      .widget-title {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 700;
        font-size: 1.5rem;
        margin: 0 0 20px;
        color: var(--text);
        text-align: center;
      }

      .widget-description {
        color: var(--text-light);
        text-align: center;
        margin-bottom: 30px;
        line-height: 1.6;
        max-width: 300px;
      }

      .prayer-widget-container {
        position: relative;
        border-radius: 16px;
        overflow: hidden;
        transition: none;
        background: transparent;
        padding: 0;
        border: none;
      }

      .prayer-widget-container::before {
        display: none;
      }

      .prayer-widget-container:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 98, 51, 0.3);
      }

      .prayer-widget-container iframe {
        border: none;
        border-radius: 16px;
        display: block;
        background: white;
        position: relative;
        z-index: 1;
      }

      /* Location Input Styles */
      .location-input-section {
        padding: 0;
        background: transparent;
        border-radius: 0;
        margin-bottom: 0;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin: 0;
      }

      .location-input {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        font-size: 1rem;
        background: #1a1a1a;
        color: #ffffff;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      .location-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .location-input:focus {
        outline: none;
        border-color: #006233;
        box-shadow: 0 0 0 3px rgba(0, 98, 51, 0.25);
      }

      .search-btn {
        background: #006233; /* Saudi green */
        color: #ffffff;
        border: none;
        border-radius: 12px;
        padding: 12px 20px;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 98, 51, 0.35);
      }

      .current-location-btn {
        width: 100%;
        background: #1a1a1a;
        color: #ffffff;
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        padding: 12px 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.15s ease, border-color 0.15s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .current-location-btn:hover {
        background: #0f0f10;
        color: #ffffff;
        border-color: #006233;
      }

      /* Loading State */
      .loading-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background: white;
        border-radius: 16px;
        padding: 40px;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--border);
        border-top: 4px solid var(--saudi-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Prayer Times Display - Modern Theme */
      .prayer-times-display {
        background: transparent;
        border-radius: 0;
        padding: 0;
        box-shadow: none;
        border: none;
        position: relative;
        z-index: 1;
      }

      .prayer-header-info {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        position: relative;
        z-index: 1;
      }

      .location-name {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 800;
        font-size: 2rem;
        color: #ffffff;
        margin: 0 0 12px;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 1;
      }

      .current-date {
        color: rgba(255, 255, 255, 0.8);
        margin: 0;
        font-size: 1.2rem;
        font-weight: 500;
        position: relative;
        z-index: 1;
      }

      .prayer-times-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
        position: relative;
        z-index: 1;
      }

      .prayer-time-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 24px 18px;
        background: #141414;
        border-radius: 16px;
        transition: all 0.25s ease;
        border: 1px solid #2a2a2a;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
        opacity: 0;
        transform: translateY(20px);
        position: relative;
        overflow: hidden;
        text-align: center;
        min-height: 140px;
      }

      .prayer-time-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ffffff, rgba(255, 255, 255, 0.35));
        transition: height 0.2s ease;
      }

      .prayer-time-item.animate {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      .prayer-time-item:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 36px rgba(0, 0, 0, 0.35);
        border-color: #3a3a3a;
        background: #171717;
      }

      .prayer-time-item:hover::before {
        height: 5px;
      }

      /* unify top accent to monochrome; per-prayer overrides removed */

      .prayer-time {
        font-weight: 800;
        color: #ffffff;
        font-size: 2.2rem;
        font-family: "Cairo", system-ui, sans-serif;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        letter-spacing: 1px;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
      }

      .prayer-name {
        font-weight: 600;
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.1rem;
        font-family: "Cairo", system-ui, sans-serif;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 1;
      }

      .prayer-icon {
        font-size: 2rem;
        margin-bottom: 12px;
        position: relative;
        z-index: 1;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      /* Next Prayer Countdown */
      .next-prayer-card {
        background: #111111;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
        border: 1px solid #202020;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      .next-prayer-card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: rotate 15s linear infinite;
        z-index: 0;
      }

      .countdown-container {
        text-align: center;
        position: relative;
        z-index: 1;
      }

      .countdown-title {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 700;
        font-size: 1.5rem;
        color: #ffffff;
        margin: 0 0 20px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .countdown-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .next-prayer-name {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 600;
        font-size: 1.3rem;
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .countdown-timer {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 800;
        font-size: 2.5rem;
        color: white;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        letter-spacing: 2px;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .hijri-date-info {
        text-align: center;
        padding: 16px;
        background: #111111;
        border-radius: 12px;
        margin-top: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
        border: 1px solid #202020;
      }

      .hijri-date {
        color: white;
        font-weight: 700;
        margin: 0;
        font-family: "Cairo", system-ui, sans-serif;
        font-size: 1.1rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      /* Animation keyframes */
      @keyframes slideInFromLeft {
        0% {
          opacity: 0;
          transform: translateX(-50px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Error State */
      .error-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background: white;
        border-radius: 16px;
        padding: 40px;
        text-align: center;
      }

      .error-icon {
        font-size: 3rem;
        margin-bottom: 16px;
      }

      .error-message {
        color: var(--text-light);
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .retry-btn {
        background: var(--saudi-green);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .retry-btn:hover {
        background: var(--saudi-gold);
        transform: translateY(-2px);
      }

      .widget-settings {
        background: var(--bg-accent);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        border: 1px solid var(--border);
      }

      .settings-title {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 600;
        margin: 0 0 15px;
        color: var(--text);
        font-size: 1.1rem;
      }

      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .setting-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .setting-label {
        font-weight: 500;
        color: var(--text);
        font-size: 0.9rem;
      }

      .setting-value {
        color: var(--text-light);
        font-size: 0.85rem;
      }

      .prayer-info {
        text-align: center;
        margin-top: 40px;
        padding: 30px;
        background: var(--bg-accent);
        border-radius: 16px;
        border: 1px solid var(--border);
      }

      .prayer-info h3 {
        font-family: "Cairo", system-ui, sans-serif;
        font-weight: 700;
        margin: 0 0 12px;
        color: var(--text);
      }

      .prayer-info p {
        color: var(--text-light);
        margin: 0;
        line-height: 1.6;
      }

      @media (max-width: 768px) {
        .prayer-title {
          font-size: 2.2rem;
        }

        .prayer-widget-section {
          margin-top: -40px;
          max-width: 520px;
          gap: 12px;
        }

        .location-card,
        .prayer-times-card {
          padding: 25px;
        }

        .prayer-times-grid {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 15px;
        }

        .prayer-time-item {
          padding: 20px 15px;
          min-height: 120px;
        }

        .prayer-time {
          font-size: 1.8rem;
        }

        .prayer-icon {
          font-size: 1.5rem;
        }

        .settings-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .widget-settings {
          padding: 15px;
        }
      }

      @media (max-width: 480px) {
        .prayer-container {
          padding: 0 15px;
        }

        .prayer-widget-section {
          padding: 15px;
        }

        .prayer-times-display {
          padding: 20px;
        }

        .prayer-time-item {
          padding: 16px 20px;
          flex-direction: column;
          text-align: center;
          gap: 8px;
        }

        .prayer-time {
          font-size: 1.2rem;
        }

        .prayer-name {
          font-size: 1rem;
        }

        .location-name {
          font-size: 1.3rem;
        }

        .widget-title {
          font-size: 1.3rem;
        }

        .input-group {
          flex-direction: column;
        }

        .search-btn {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <header class="header" id="header">
      <div class="header-inner">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true"></div>
          <div>
            <div class="brand-title">Visit Saudi Arabia</div>
            <div class="brand-sub">Explore regions, heritage, and faith</div>
          </div>
        </div>

        <div class="nav-container">
          <button
            class="theme-toggle"
            id="themeToggle"
            aria-label="Toggle theme"
          >
            üåô Dark
          </button>

          <nav class="nav" aria-label="Main Navigation">
            <div class="item"><a href="index.html#home">Home</a></div>
            <div class="item">
              <a href="index.html#religious">Religious Sites</a>
            </div>
            <div class="item"><a href="history.html">History</a></div>
            <div class="item"><a href="index.html#heritage">Heritage</a></div>
            <div class="item"><a href="index.html#regions">Regions</a></div>
            <div class="item has-dropdown">
              <a href="islamic-guide.html">Islamic Guide ‚ñæ</a>
              <div class="dropdown" role="menu">
                <a href="qibla.html" role="menuitem">Qibla Finder</a>
                <a href="prayer-times.html" role="menuitem">Prayer Times</a>
                <a href="quran.html" role="menuitem">Quran & Du'a</a>
                <a href="mosques.html" role="menuitem">Nearby Mosques</a>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </header>
    <main class="prayer-container">
      <section class="hero-banner">
        <div class="hero-content">
          <div class="prayer-header">
            <h1 class="prayer-title">Prayer Times</h1>
            <p class="prayer-subtitle">Stay connected with your faith</p>
          </div>
        </div>
      </section>

      <div class="prayer-widget-section">
        <!-- Location Card -->
        <div class="location-card">
          <h3
            class="widget-title"
            style="color: white; margin-bottom: 16px; font-size: 1.6rem"
          >
            üìç Find Prayer Times
          </h3>
          <div class="location-input-section">
            <div class="input-group">
              <input
                type="text"
                id="locationInput"
                placeholder="Enter city or address (e.g., Riyadh, Saudi Arabia)"
                class="location-input"
              />
              <button
                id="getPrayerTimes"
                class="search-btn"
                style="width: 100%"
              >
                <span class="search-icon">üîç</span>
                Get Prayer Times
              </button>
            </div>
            <div
              class="current-location-btn"
              style="
                margin-top: 8px;
                background: transparent;
                border: none;
                padding: 0;
              "
            >
              <button
                id="useCurrentLocation"
                class="current-location-btn"
                style="width: 100%"
              >
                üìç Use Current Location
              </button>
            </div>
          </div>
        </div>

        <!-- Prayer Times Card -->
        <div class="prayer-times-card">
          <div
            class="prayer-widget-container"
            style="
              background: transparent;
              padding: 0;
              border: none;
              box-shadow: none;
            "
          >
            <!-- Loading State -->
            <div id="loadingState" class="loading-state" style="display: none">
              <div class="loading-spinner"></div>
              <p>Getting prayer times...</p>
            </div>

            <!-- Prayer Times Display -->
            <div
              id="prayerTimesDisplay"
              class="prayer-times-display"
              style="display: none"
            >
              <div class="prayer-header-info">
                <h4 id="locationName" class="location-name"></h4>
                <p id="currentDate" class="current-date"></p>
              </div>

              <div class="prayer-times-grid">
                <div class="prayer-time-item fajr">
                  <div class="prayer-icon">üåÖ</div>
                  <span class="prayer-time" id="fajrTime"></span>
                  <span class="prayer-name">ÿßŸÑŸÅÿ¨ÿ±</span>
                </div>

                <div class="prayer-time-item sunrise">
                  <div class="prayer-icon">‚òÄÔ∏è</div>
                  <span class="prayer-time" id="sunriseTime"></span>
                  <span class="prayer-name">ÿßŸÑÿ¥ÿ±ŸàŸÇ</span>
                </div>

                <div class="prayer-time-item dhuhr">
                  <div class="prayer-icon">üåû</div>
                  <span class="prayer-time" id="dhuhrTime"></span>
                  <span class="prayer-name">ÿßŸÑÿ∏Ÿáÿ±</span>
                </div>

                <div class="prayer-time-item asr">
                  <div class="prayer-icon">üå§Ô∏è</div>
                  <span class="prayer-time" id="asrTime"></span>
                  <span class="prayer-name">ÿßŸÑÿπÿµÿ±</span>
                </div>

                <div class="prayer-time-item maghrib">
                  <div class="prayer-icon">üåÖ</div>
                  <span class="prayer-time" id="maghribTime"></span>
                  <span class="prayer-name">ÿßŸÑŸÖÿ∫ÿ±ÿ®</span>
                </div>

                <div class="prayer-time-item isha">
                  <div class="prayer-icon">üåô</div>
                  <span class="prayer-time" id="ishaTime"></span>
                  <span class="prayer-name">ÿßŸÑÿπÿ¥ÿßÿ°</span>
                </div>
              </div>

              <!-- Next Prayer Countdown -->
              <div
                class="next-prayer-card"
                id="nextPrayerCard"
                style="display: none"
              >
                <div class="countdown-container">
                  <h4 class="countdown-title">Next Prayer</h4>
                  <div class="countdown-info">
                    <span class="next-prayer-name" id="nextPrayerName"></span>
                    <div class="countdown-timer" id="countdownTimer"></div>
                  </div>
                </div>
              </div>

              <div class="hijri-date-info">
                <p id="hijriDate" class="hijri-date"></p>
              </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error-state" style="display: none">
              <div class="error-icon">‚ö†Ô∏è</div>
              <p id="errorMessage" class="error-message"></p>
              <button id="retryBtn" class="retry-btn">Try Again</button>
            </div>
          </div>
        </div>
      </div>

      <div class="prayer-info">
        <h3>Accurate Prayer Times</h3>
        <p>
          Get real-time prayer times for your current location or any city in
          Saudi Arabia. The widget automatically adjusts for your timezone and
          provides accurate timings for Fajr, Dhuhr, Asr, Maghrib, and Isha
          prayers.
        </p>
      </div>
    </main>
    <script src="../scripts/Script.js"></script>
    <script>
      // Prayer Times API Integration
      class PrayerTimesWidget {
        constructor() {
          this.apiBase = "https://api.aladhan.com/v1";
          this.initializeElements();
          this.bindEvents();
        }

        initializeElements() {
          this.locationInput = document.getElementById("locationInput");
          this.getPrayerTimesBtn = document.getElementById("getPrayerTimes");
          this.useCurrentLocationBtn =
            document.getElementById("useCurrentLocation");
          this.loadingState = document.getElementById("loadingState");
          this.prayerTimesDisplay =
            document.getElementById("prayerTimesDisplay");
          this.errorState = document.getElementById("errorState");
          this.retryBtn = document.getElementById("retryBtn");

          // Prayer time elements
          this.locationName = document.getElementById("locationName");
          this.currentDate = document.getElementById("currentDate");
          this.hijriDate = document.getElementById("hijriDate");
          this.fajrTime = document.getElementById("fajrTime");
          this.sunriseTime = document.getElementById("sunriseTime");
          this.dhuhrTime = document.getElementById("dhuhrTime");
          this.asrTime = document.getElementById("asrTime");
          this.maghribTime = document.getElementById("maghribTime");
          this.ishaTime = document.getElementById("ishaTime");

          // Countdown elements
          this.nextPrayerCard = document.getElementById("nextPrayerCard");
          this.nextPrayerName = document.getElementById("nextPrayerName");
          this.countdownTimer = document.getElementById("countdownTimer");
        }

        bindEvents() {
          this.getPrayerTimesBtn.addEventListener("click", () =>
            this.getPrayerTimes()
          );
          this.useCurrentLocationBtn.addEventListener("click", () =>
            this.useCurrentLocation()
          );
          this.retryBtn.addEventListener("click", () => this.retry());

          this.locationInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              this.getPrayerTimes();
            }
          });
        }

        async getPrayerTimes(presetLocation) {
          const location = (presetLocation ?? this.locationInput.value).trim();
          if (!location) {
            this.showError("Please enter a location");
            return;
          }

          this.showLoading();

          try {
            // Primary: timingsByAddress
            const byAddressUrl = `${
              this.apiBase
            }/timingsByAddress?address=${encodeURIComponent(
              location
            )}&method=3&school=0`;
            let response = await fetch(byAddressUrl, {
              cache: "no-store",
              mode: "cors",
            });

            let data = null;
            try {
              data = await response.json();
            } catch (_) {}

            if (!response.ok || data?.code !== 200 || !data?.data?.timings) {
              // Fallback: timingsByCity (first token as city; default country SA)
              const [cityToken] = location.split(",").map((s) => s.trim());
              const city = encodeURIComponent(cityToken || location);
              const country = encodeURIComponent("Saudi Arabia");
              const byCityUrl = `${this.apiBase}/timingsByCity?city=${city}&country=${country}&method=3&school=0`;
              response = await fetch(byCityUrl, {
                cache: "no-store",
                mode: "cors",
              });
              data = await response.json();
              if (!response.ok || data?.code !== 200 || !data?.data?.timings) {
                throw new Error(
                  data?.data?.message || `API failed (address and city lookups)`
                );
              }
            }

            this.displayPrayerTimes(data.data, location);
          } catch (error) {
            console.error("Error fetching prayer times:", error);
            this.showError(
              `Failed to get prayer times. ${
                error?.message || "Please check the location and try again."
              }`
            );
          }
        }

        async useCurrentLocation() {
          if (!navigator.geolocation) {
            this.showError("Geolocation is not supported by your browser.");
            return;
          }

          // Geolocation requires a secure context; localhost is allowed
          const isSecure =
            window.isSecureContext || location.hostname === "localhost";
          if (!isSecure) {
            this.showError(
              "Location requires a secure context. Please run on localhost or HTTPS."
            );
            return;
          }

          this.showLoading();

          try {
            const position = await new Promise((resolve, reject) => {
              navigator.geolocation.getCurrentPosition(resolve, reject, {
                timeout: 10000,
                enableHighAccuracy: true,
              });
            });

            const { latitude, longitude } = position.coords;
            // Primary: timings with lat/lon
            let response = await fetch(
              `${this.apiBase}/timings?latitude=${latitude}&longitude=${longitude}&method=3&school=0`,
              { cache: "no-store", mode: "cors" }
            );

            let data = null;
            try {
              data = await response.json();
            } catch (_) {}

            if (!response.ok || data?.code !== 200 || !data?.data?.timings) {
              // Fallback: address string "lat,lon"
              const addr = `${latitude}, ${longitude}`;
              response = await fetch(
                `${this.apiBase}/timingsByAddress?address=${encodeURIComponent(
                  addr
                )}&method=3&school=0`,
                { cache: "no-store", mode: "cors" }
              );
              data = await response.json();
              if (!response.ok || data?.code !== 200 || !data?.data?.timings) {
                throw new Error(
                  data?.data?.message || `API failed for your location`
                );
              }
            }

            this.displayPrayerTimes(data.data, "Current Location");
          } catch (error) {
            console.error("Error getting current location:", error);
            if (error.code === 1) {
              this.showError(
                "Please allow location access to use this feature."
              );
            } else if (error.code === 2) {
              this.showError("Location information is unavailable.");
            } else if (error.code === 3) {
              this.showError("The request to get your location timed out.");
            } else {
              this.showError(
                `Failed to get your location. ${
                  error?.message || "Try entering a location manually."
                }`
              );
            }
          }
        }

        displayPrayerTimes(data, location) {
          const { timings, date } = data;

          // Update location and date
          this.locationName.textContent = location;
          this.currentDate.textContent = date.readable;
          this.hijriDate.textContent = `${date.hijri.date} (${date.hijri.month.en} ${date.hijri.year} AH)`;

          // Update prayer times
          this.fajrTime.textContent = timings.Fajr;
          this.sunriseTime.textContent = timings.Sunrise;
          this.dhuhrTime.textContent = timings.Dhuhr;
          this.asrTime.textContent = timings.Asr;
          this.maghribTime.textContent = timings.Maghrib;
          this.ishaTime.textContent = timings.Isha;

          this.showPrayerTimes();

          // Animate prayer times one by one
          this.animatePrayerTimes();

          // Start countdown to next prayer
          this.startCountdown(timings);
        }

        animatePrayerTimes() {
          const prayerItems = document.querySelectorAll(".prayer-time-item");

          // Reset all items
          prayerItems.forEach((item) => {
            item.classList.remove("animate");
          });

          // Animate each item with delay
          prayerItems.forEach((item, index) => {
            setTimeout(() => {
              item.classList.add("animate");

              // Add a subtle pulse effect for the current prayer
              if (index === 0) {
                // Fajr
                setTimeout(() => {
                  item.style.animation = "pulse 0.6s ease-in-out";
                  setTimeout(() => {
                    item.style.animation = "";
                  }, 600);
                }, 200);
              }
            }, index * 150); // 150ms delay between each item
          });
        }

        showLoading() {
          this.hideAllStates();
          this.loadingState.style.display = "flex";
        }

        showPrayerTimes() {
          this.hideAllStates();
          this.prayerTimesDisplay.style.display = "block";
        }

        showError(message) {
          this.hideAllStates();
          this.errorState.style.display = "flex";
          document.getElementById("errorMessage").textContent = message;
        }

        hideAllStates() {
          this.loadingState.style.display = "none";
          this.prayerTimesDisplay.style.display = "none";
          this.errorState.style.display = "none";
        }

        retry() {
          this.hideAllStates();
        }

        startCountdown(timings) {
          this.nextPrayerCard.style.display = "block";

          const prayers = [
            { name: "Fajr", time: timings.Fajr, arabic: "ÿßŸÑŸÅÿ¨ÿ±" },
            { name: "Sunrise", time: timings.Sunrise, arabic: "ÿßŸÑÿ¥ÿ±ŸàŸÇ" },
            { name: "Dhuhr", time: timings.Dhuhr, arabic: "ÿßŸÑÿ∏Ÿáÿ±" },
            { name: "Asr", time: timings.Asr, arabic: "ÿßŸÑÿπÿµÿ±" },
            { name: "Maghrib", time: timings.Maghrib, arabic: "ÿßŸÑŸÖÿ∫ÿ±ÿ®" },
            { name: "Isha", time: timings.Isha, arabic: "ÿßŸÑÿπÿ¥ÿßÿ°" },
          ];

          const updateCountdown = () => {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();

            let nextPrayer = null;
            let nextPrayerTime = null;

            for (const prayer of prayers) {
              const [hours, minutes] = prayer.time.split(":").map(Number);
              const prayerTime = hours * 60 + minutes;

              if (prayerTime > currentTime) {
                nextPrayer = prayer;
                nextPrayerTime = prayerTime;
                break;
              }
            }

            if (!nextPrayer) {
              // If no prayer found for today, get tomorrow's Fajr
              nextPrayer = prayers[0];
              nextPrayerTime = prayers[0].time.split(":").map(Number);
              nextPrayerTime =
                nextPrayerTime[0] * 60 + nextPrayerTime[1] + 24 * 60; // Add 24 hours
            }

            const timeUntilPrayer = nextPrayerTime - currentTime;
            const hours = Math.floor(timeUntilPrayer / 60);
            const minutes = timeUntilPrayer % 60;

            this.nextPrayerName.textContent = nextPrayer.arabic;
            this.countdownTimer.textContent = `${hours
              .toString()
              .padStart(2, "0")}:${minutes.toString().padStart(2, "0")}`;
          };

          updateCountdown();
          this.countdownInterval = setInterval(updateCountdown, 60000); // Update every minute
        }

        stopCountdown() {
          if (this.countdownInterval) {
            clearInterval(this.countdownInterval);
            this.countdownInterval = null;
          }
        }
      }

      // Initialize the prayer times widget when the page loads (or immediately if already loaded)
      (function initPrayerWidget() {
        const start = () => {
          const widget = new PrayerTimesWidget();
          widget.getPrayerTimes("Riyadh, Saudi Arabia");
        };
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", start);
        } else {
          start();
        }
      })();
    </script>
  </body>
</html>
