<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;800;900&family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 20px;
            background: #faf8f3;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 98, 51, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8f5e8;
        }

        .header h1 {
            color: #006233;
            font-family: 'Cairo', sans-serif;
            font-weight: 700;
            margin: 0;
            font-size: 2rem;
        }

        .header p {
            color: #666;
            margin: 8px 0 0 0;
        }

        .test-section {
            background: #f8f9fa;
            border: 1px solid #e8f5e8;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h3 {
            color: #006233;
            font-family: 'Cairo', sans-serif;
            margin: 0 0 16px 0;
        }

        .btn {
            background: #006233;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            margin: 8px 8px 8px 0;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #004d26;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .result {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .loading {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .region-info {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }

        .coordinates {
            font-family: monospace;
            background: #f1f1f1;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Geoapify Boundaries API Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
        </div>

        <div class="test-section">
            <h3>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h3>
            <p>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©</p>
            <button id="searchSaudi" class="btn">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</button>
            <div id="saudiSearchResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h3>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
            <button id="getRegions" class="btn">ğŸ“ ØªØ­Ù…ÙŠÙ„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</button>
            <button id="getRiyadh" class="btn">ğŸ›ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶</button>
            <button id="getMakkah" class="btn">ğŸ•Œ Ù…Ù†Ø·Ù‚Ø© Ù…ÙƒØ©</button>
            <button id="getMadinah" class="btn">ğŸ•Œ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</button>
            <div id="regionsResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ù…</h3>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© ÙˆØ§Ù„Ø¯ÙŠÙ†ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
            <button id="getMosques" class="btn">ğŸ•Œ Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯</button>
            <button id="getRestaurants" class="btn">ğŸ½ï¸ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</button>
            <button id="getHotels" class="btn">ğŸ¨ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</button>
            <div id="placesResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        class SaudiBoundariesTester {
            constructor() {
                this.apiKey = '636790d9734f4bf2af3a9f2393bdcc1d';
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('searchSaudi').addEventListener('click', () => this.searchSaudi());
                document.getElementById('getRegions').addEventListener('click', () => this.getRegions());
                document.getElementById('getRiyadh').addEventListener('click', () => this.getRegionBoundaries('Riyadh'));
                document.getElementById('getMakkah').addEventListener('click', () => this.getRegionBoundaries('Makkah'));
                document.getElementById('getMadinah').addEventListener('click', () => this.getRegionBoundaries('Medina'));
                document.getElementById('getMosques').addEventListener('click', () => this.getPlaces('religion.place_of_worship'));
                document.getElementById('getRestaurants').addEventListener('click', () => this.getPlaces('commercial.restaurant'));
                document.getElementById('getHotels').addEventListener('click', () => this.getPlaces('accommodation.hotel'));
            }

            async searchSaudi() {
                const resultDiv = document.getElementById('saudiSearchResult');
                this.showLoading(resultDiv, 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©...');

                try {
                    const searchUrl = `https://api.geoapify.com/v1/geocode/search?text=Saudi Arabia&limit=5&apiKey=${this.apiKey}`;
                    
                    const response = await fetch(searchUrl);
                    const data = await response.json();

                    if (data.features && data.features.length > 0) {
                        const saudiInfo = data.features.find(feature => 
                            feature.properties.country === 'Saudi Arabia' || 
                            feature.properties.country_code === 'SA'
                        );

                        if (saudiInfo) {
                            this.showSuccess(resultDiv, `
                                <h4>ğŸ‡¸ğŸ‡¦ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h4>
                                <div class="region-info">
                                    <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${saudiInfo.properties.name || 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'}<br>
                                    <strong>Ø§Ù„Ø±Ù…Ø²:</strong> ${saudiInfo.properties.country_code || 'SA'}<br>
                                    <strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong> 
                                    <span class="coordinates">${saudiInfo.geometry.coordinates[1].toFixed(6)}, ${saudiInfo.geometry.coordinates[0].toFixed(6)}</span><br>
                                    <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${saudiInfo.properties.type || 'country'}
                                </div>
                                <pre>${JSON.stringify(saudiInfo.properties, null, 2)}</pre>
                            `);
                        } else {
                            this.showError(resultDiv, 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
                        }
                    } else {
                        this.showError(resultDiv, 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬');
                    }
                } catch (error) {
                    this.showError(resultDiv, `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ${error.message}`);
                }
            }

            async getRegions() {
                const resultDiv = document.getElementById('regionsResult');
                this.showLoading(resultDiv, 'ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚...');

                try {
                    const regions = [
                        'Riyadh Region',
                        'Makkah Region', 
                        'Medina Region',
                        'Eastern Province',
                        'Al Qassim Region',
                        'Hail Region',
                        'Tabuk Region',
                        'Northern Borders Region',
                        'Jazan Region',
                        'Najran Region',
                        'Al Bahah Region',
                        'Al Jouf Region'
                    ];

                    let results = [];
                    
                    for (const region of regions.slice(0, 3)) { // Test first 3 regions
                        try {
                            const searchUrl = `https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(region)}&filter=countrycode:sa&limit=1&apiKey=${this.apiKey}`;
                            const response = await fetch(searchUrl);
                            const data = await response.json();
                            
                            if (data.features && data.features.length > 0) {
                                results.push(data.features[0]);
                            }
                        } catch (error) {
                            console.warn(`Error searching for ${region}:`, error);
                        }
                    }

                    if (results.length > 0) {
                        let html = '<h4>ğŸ“ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©</h4>';
                        results.forEach(region => {
                            html += `
                                <div class="region-info">
                                    <strong>${region.properties.name || 'Ù…Ù†Ø·Ù‚Ø©'}</strong><br>
                                    <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${region.properties.type || 'unknown'}<br>
                                    <strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong> 
                                    <span class="coordinates">${region.geometry.coordinates[1].toFixed(6)}, ${region.geometry.coordinates[0].toFixed(6)}</span>
                                </div>
                            `;
                        });
                        this.showSuccess(resultDiv, html);
                    } else {
                        this.showError(resultDiv, 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚');
                    }
                } catch (error) {
                    this.showError(resultDiv, `Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: ${error.message}`);
                }
            }

            async getRegionBoundaries(regionName) {
                const resultDiv = document.getElementById('regionsResult');
                this.showLoading(resultDiv, `ØªØ­Ù…ÙŠÙ„ Ø­Ø¯ÙˆØ¯ ${regionName}...`);

                try {
                    // First search for the region
                    const searchUrl = `https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(regionName)}&filter=countrycode:sa&limit=1&apiKey=${this.apiKey}`;
                    const response = await fetch(searchUrl);
                    const data = await response.json();

                    if (data.features && data.features.length > 0) {
                        const region = data.features[0];
                        this.showSuccess(resultDiv, `
                            <h4>ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ${regionName}</h4>
                            <div class="region-info">
                                <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${region.properties.name}<br>
                                <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${region.properties.type}<br>
                                <strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong> 
                                <span class="coordinates">${region.geometry.coordinates[1].toFixed(6)}, ${region.geometry.coordinates[0].toFixed(6)}</span><br>
                                <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„:</strong> ${region.properties.formatted || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                            </div>
                        `);
                    } else {
                        this.showError(resultDiv, `Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${regionName}`);
                    }
                } catch (error) {
                    this.showError(resultDiv, `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ${regionName}: ${error.message}`);
                }
            }

            async getPlaces(category) {
                const resultDiv = document.getElementById('placesResult');
                const categoryName = {
                    'religion.place_of_worship': 'Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯',
                    'commercial.restaurant': 'Ø§Ù„Ù…Ø·Ø§Ø¹Ù…',
                    'accommodation.hotel': 'Ø§Ù„ÙÙ†Ø§Ø¯Ù‚'
                }[category] || 'Ø§Ù„Ù…Ø¹Ø§Ù„Ù…';

                this.showLoading(resultDiv, `ØªØ­Ù…ÙŠÙ„ ${categoryName}...`);

                try {
                    // Saudi Arabia bounds
                    const bounds = { west: 34.5, east: 55.7, south: 16.3, north: 32.2 };
                    const placesUrl = `https://api.geoapify.com/v2/places?categories=${category}&filter=rect:${bounds.west},${bounds.north},${bounds.east},${bounds.south}&limit=10&apiKey=${this.apiKey}`;
                    
                    const response = await fetch(placesUrl);
                    const data = await response.json();

                    if (data.features && data.features.length > 0) {
                        let html = `<h4>ğŸ¯ ${categoryName} ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (${data.features.length} Ù†ØªÙŠØ¬Ø©)</h4>`;
                        
                        data.features.forEach(place => {
                            const name = place.properties.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                            const address = place.properties.formatted || '';
                            const coordinates = place.geometry.coordinates;
                            
                            html += `
                                <div class="region-info">
                                    <strong>${name}</strong><br>
                                    ${address ? `<strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${address}<br>` : ''}
                                    <strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong> 
                                    <span class="coordinates">${coordinates[1].toFixed(6)}, ${coordinates[0].toFixed(6)}</span>
                                </div>
                            `;
                        });
                        
                        this.showSuccess(resultDiv, html);
                    } else {
                        this.showError(resultDiv, `Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${categoryName} ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©`);
                    }
                } catch (error) {
                    this.showError(resultDiv, `Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ${categoryName}: ${error.message}`);
                }
            }

            showLoading(element, message) {
                element.innerHTML = `<div class="loading">ğŸ”„ ${message}</div>`;
                element.style.display = 'block';
            }

            showSuccess(element, content) {
                element.innerHTML = `<div class="success">âœ… ${content}</div>`;
                element.style.display = 'block';
            }

            showError(element, message) {
                element.innerHTML = `<div class="error">âŒ ${message}</div>`;
                element.style.display = 'block';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SaudiBoundariesTester();
        });
    </script>
</body>
</html>
